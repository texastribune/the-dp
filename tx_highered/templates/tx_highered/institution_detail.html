{% extends "tx_highered/detail_base.html" %}
{% load layout_helpers humanize instachart %}
{% load webdesign %}
{% load url from future %}


{% block head_title %}{{ object.name }}{% endblock %}
{% block page_title %}{{ object.name }}{% endblock %}


{% block breadcrumb_items %}
  <li class="active"><a href="">{{ object.name }}</a></li>
{% endblock %}


{% block page_top %}
  <div class="row">
    <div class="span9">
      {% include "tx_highered/includes/sentences.html" %}
    </div>

    <div class="span3">
      {% render_model object "quick-stats" %}
    </div>
  </div>
{% endblock %}


{% block main %}
  <section id="pricetrends">
    <h3>Price Trends <small class="page-anchor"><a href="#pricetrends"><i class="icon-share"></i></a></small></h3>
    <div class="well well-small chart-help">
      {% lorem 20 w %}
    </div>
    {% instachart object.pricetrends.all "pricetrends" %}

    <table class="chart-data table table-striped table-condensed" style="width:100%;">
      <thead>
        <tr>
          <th></th>
          {% for year in object.tuition_buckets.years %}<th>{{ year }}</th>{% endfor %}
        </tr>
      </thead>

      <tr>
        <th style="text-align: right; white-space:nowrap;">In-State Tuition</th>
        {% for a in object.tuition_buckets.in_state.values %}
          <td><span class="dollar">$</span><span class="currency">{{ a|intcomma }}</span></td>
        {% endfor %}
      </tr>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Out-Of-State Tuition</th>
        {% for a in object.tuition_buckets.out_of_state.values %}
          <td><span class="dollar">$</span><span class="currency">{{ a|intcomma }}</span></td>
        {% endfor %}
      </tr>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Books &amp; Supplies</th>
        {% for a in object.tuition_buckets.books_and_supplies.values %}
          <td><span class="dollar">$</span><span class="currency">{{ a|intcomma }}</span></td>
        {% endfor %}
      </tr>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Room &amp; Board</th>
        {% for a in object.tuition_buckets.room_and_board.values %}
          <td><span class="dollar">$</span><span class="currency">{{ a|intcomma }}</span></td>
        {% endfor %}
      </tr>

    </table>
    <div class="row">

      <div class="chart d3-viz chart-viz span10">
      </div>

      <div class="span2">
        <div class="chart-help">
          <h3>Total Costs</h3>

          <ul class="nav nav-pills nav-stacked">
            <li class="active">
              <a href="#" data-idx="1">In-State</a></li>
            <li>
              <a href="#" data-idx="0">Out-of-State</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="span6">
        <div class="well well-small chart-help">
          In-State vs Out-of-State Tuition Costs.
        </div>
        <div class="chart d3-viz chart-viz"></div>
      </div>


      <div class="span6">
        <div class="well well-small chart-help">
          Relative In-State vs Out-of-State Tuition Costs.
        </div>
        <div class="chart d3-viz chart-viz"></div>
      </div>
    </div>
  </section>

  <section id="testing">
    <h3>Test Scores <small class="page-anchor"><a href="#testing"><i class="icon-share"></i></a></small></h3>
    <div class="well well-small chart-help">
      {% lorem 20 w %}
    </div>
    {% instachart object.testscores.all "testscores" %}

    <table class="chart-data table table-striped table-condensed" style="width:100%;">
      <thead>
        <tr>
          <th></th>
          {% for year in object.sat_score_buckets.years %}<th style="text-align:center;">{{ year }}</th>{% endfor %}
        </tr>
      </thead>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Verbal</th>
        {% for a in object.sat_score_buckets.verbal_range.values %}<td style="text-align:center;">{{ a }}</td>{% endfor %}
      </tr>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Math</th>
        {% for a in object.sat_score_buckets.math_range.values %}<td style="text-align:center;">{{ a }}</td>{% endfor %}
      </tr>

      <tr>
        <th style="text-align: right; white-space:nowrap;">Writing</th>
        {% for a in object.sat_score_buckets.writing_range.values %}<td style="text-align:center;">{{ a }}</td>{% endfor %}
      </tr>

    </table>
  </section>

  <section id="admissions">
    <h3>Admissions <small class="page-anchor"><a href="#admissions"><i class="icon-share"></i></a></small></h3>
    <div class="well well-small chart-help">
      {% lorem 20 w %}
    </div>

    {% if object.admissions.all.exists %}
      {% with object_list=object.admissions.all %}
        {% include "instachart/simplechart/admissions.html" %}
      {% endwith %}

    <table class="chart-data table table-striped table-condensed admissions" style="width:100%;">
        <thead>
          <tr>
            <th></th>
            {% for year in object.admission_buckets.years %}<th>{{ year }}</th>{% endfor %}
          </tr>
        </thead>

        <tbody>
          <tr>
            <th>Applicants</th>
            {% for a in object.admission_buckets.applicants.values %}<td>{{ a|intcomma }}</td>{% endfor %}
          </tr>

          <tr>
            <th>Admitted</th>
            {% for a in object.admission_buckets.admitted.values %}<td>{{ a.0|intcomma }} <small>({{ a.1 }}%)</small></td>{% endfor %}
          </tr>

          <tr>
            <th>Enrolled</th>
            {% for a in object.admission_buckets.enrolled.values %}<td>{{ a.0|intcomma }} <small>({{ a.1 }}%)</small></td>{% endfor %}
          </tr>
        </tbody>
      </table>

      <div class="row">
        <div class="span10">
          <div class="d3-viz chart-viz" style="height: 300px"></div>
        </div>

        <div class="span2">
          <div class="well well-condensed">
            <p>
              This visualization shows the number of applicants,
              those admitted, and the number of students that are
              enrolled.
            </p>

            <a href="#" class="zoom">
              <i class="icon-plus"></i>
              Toggle Applicants
            </a>
          </div>
        </div>
      {% else %}
        {% include "tx_highered/includes/no_data.html" %}
      {% endif %}
  </section>

  <section id="enrollment">
    <h3>Enrollment</h3>
    <div class="well well-small chart-help">
      {% lorem 20 w %}
    </div>
    {% instachart object.enrollment.all %}
    <div class="row">
      {# use grid and span12 because we'll probably need the grid #}
      <div class="span12">
        <div class="chart d3-viz chart-viz"></div>
      </div>
    </div>
  </section>

  <section id="gradrates">
    <h3>Graduation Rates <small class="page-anchor"><a href="#gradrates"><i class="icon-share"></i></a></small></h3>
    <div class="well well-small chart-help">
      {% lorem 20 w %}
    </div>
    {% instachart object.graduationrates.all "gradrates" %}
  </section>
{% endblock %}

{% block extra_script %}{{ block.super }}
<script src="{{ STATIC_URL }}vendor/underscore.js/1.3.3/underscore{% if not debug %}-min{% endif %}.js"></script>
<script src="{{ STATIC_URL }}js/bootstrap-tooltip-d3.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/tabbouleh.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/barchart.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/pricetrends-chart.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/admissions-chart.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/ethnicity-chart.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/testscores-chart.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/gradrates-chart.js"></script>
<script>
  $(".onion").onionize();

  // Enrollment chart
  init_enrollment_chart({
    url: "{% url "tx_highered:enrollment_api" object.id %}"
  });


  var testchart_url = "{% url "tx_highered:institution_api" object.id "testscores" %}";
  var testchart = new TestScoresChart(
        $('#testing').placeChartContainer(),
        testchart_url,
        {
          color: ['#066', '#c93', '#339'],
          tooltip: function(){
            var d = this.__data__;
            return d.title ||
            "" + d.y + " - " + d.y_max + "";
          }
        }
      );
</script>
{% endblock %}
