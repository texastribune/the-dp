{% extends "tx_highered/two_column_base.html" %}
{% load layout_helpers humanize instachart %}
{% load webdesign %}


{% block head_title %}{{ object.name }}{% endblock %}
{% block page_title %}{{ object.name }}{% endblock %}


{% block main %}
  {% if 0 and object.wikipedia_abstract %}
    <div class="wikipedia-abstract">
      <div class="row">
        <div class="span8">
          <div class="well">
            <small>From <a class="external" href="{{ object.wikipedia_url }}" target="_blank">Wikipedia</a>:</small>
            {{ object.wikipedia_abstract|safe }}
            <p>
              <small class="attribution cc">
                Text is available under the <a href="//en.wikipedia.org/wiki/Wikipedia:Text_of_Creative_Commons_Attribution-ShareAlike_3.0_Unported_License" rel="license">Creative Commons Attribution-ShareAlike License</a><a style="display:none;" href="//creativecommons.org/licenses/by-sa/3.0/" rel="license"></a>;
                {{ object.wikipedia_scraped }}
              </small>
            </p>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  {% lorem 3 p %}

  <section id="pricetrends">
    <h3>Price Trends <small class="page-anchor"><a href="#pricetrends"><i class="icon-share"></i></a></small></h3>
    <p>{% lorem 20 w %}</p>
    {% instachart object.pricetrends.all "pricetrends" %}
  </section>

  <section id="testing">
    <h3>Test Scores <small class="page-anchor"><a href="#testing"><i class="icon-share"></i></a></small></h3>
    {% instachart object.testscores.all "testscores" %}
  </section>

  <section id="admissions">
    <h3>Admissions <small class="page-anchor"><a href="#admissions"><i class="icon-share"></i></a></small></h3>
    {% with object_list=object.admissions_set.all %}
      {% include "instachart/admissions/admissions.html" %}
    {% endwith %}
    <p>
      <strong>How many applicants end up going to {{ institution.name }}?</strong>
      With the data we have, we can see how selective the school was by seeing how many were admitted, and looking at the number enrolled we can see how selective the applicants were. We can also look at this information over time. How fast the bars below get thinner indicate how hard it is to get into a school. Hitting the <code>Fold</code> button shows how it looks averaged out over the all the years we have available.
    </p>
    {% render_model object "funnels" %}

    <div class="d3-viz"></div>
  </section>

  <h3>Enrollment</h3>
  {% instachart object.enrollment.all %}

  <h3>Graduation Rates</h3>
  {% instachart object.graduationrates.all "graduationrates" %}
{% endblock %}


{% block rail %}
  {% if object.wikipedia_seal %}
    <div class="thumbnail">
      <img src="{{ MEDIA_URL }}{{ object.wikipedia_seal }}">
    </div>
  {% endif %}
  {% if object.wikipedia_logo %}
    <div class="thumbnail">
      <img src="{{ MEDIA_URL }}{{ object.wikipedia_logo }}">
    </div>
  {% endif %}
  {% render_model object "table" %}
{% endblock %}


{% block extra_script %}{{ block.super }}
<script src="{{ STATIC_URL }}js/bootstrap-tooltip-d3.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/tabbouleh.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/barchart-stacked.js"></script>
<script src="{{ STATIC_URL }}tx_highered/js/admissions-chart.js"></script>
<script>
  var $source = $('#pricetrends table');
  var data = buildTableData($source);
  var chart = stackedBarChart($source[0], [data[0], data[2], data[3]]);
  $source.find('th:eq(1)').click(function(){
    chart.setData([data[0], data[2], data[3]]);
  });
  $source.find('th:eq(2)').click(function(){
    chart.setData([data[1], data[2], data[3]]);
  });

  $('table').tablebars();
  $(".onion").onionize();
</script>
{% endblock %}
