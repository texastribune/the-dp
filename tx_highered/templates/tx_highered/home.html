{% extends "tx_highered/twocolumn_base.html" %}
{% load static from staticfiles %}
{# load chunks %}{# FIXME chunks is not a requirement for the app #}


{% block head_title %}Higher Education Explorer{% endblock %}


{% block breadcrumb_base %}{# DISABLE #}{% endblock %}


{% block main %}
  <section id="intro">
    {# chunk "higher-ed/explorer#intro" #}
    <p>
    The Texas Tribune Higher Education Explorer captures data on all 148 public
    and private colleges and universities in the state. Combining key academic,
    enrollment and financial records, this database collects and presents statistics
    about Texas’ institutions of higher learning in a way that is easy to understand
    and simple to navigate.
    </p>
    <p>
    The Higher Ed Explorer complements our <a href="http://www.texastribune.org/public-ed/explore/">Public Schools Explorer</a>, a
    comprehensive database of all of Texas’ 1,300 districts and 8,500 public
    schools, which we launched in July 2012. Taken together, these databases
    provide useful tools for parents, students and policymakers
    interested in understanding the data and trends behind education in Texas.
    </p>
  </section>

  <hr>

  <section class="row-fluid">
    <div class="graphic pull-right">
      <img src="//s3.amazonaws.com/static.texastribune.org/common/tx_schools/statewide-search-icon.png" />
    </div>

    <div>
      <h2>Search Colleges and Universities</h2>
      {# {% chunk "higher-ed/explorer#search" %} #}
      <p>
      Type a college or university into the box below. You can also jump to the state's 15 largest universities by enrollment from the links below.
      </p>
      <div class="input-append">{% spaceless %}
        <input type="text" class="q span7" placeholder="College or university name">
        <span class="add-on active" data-action="reset">All</span>
        <span class="add-on" data-action="public">Public</span>
        <span class="add-on" data-action="private">Private</span>
      {% endspaceless %}</div>
    </div>

    <hr>

    {% with short_list=view.get_short_list %}{% if short_list %}
      <div class="well well-small sans-serif">
        <h4>{{ short_list|length }} Featured Higher Education Institutions:</h4>
        {% for object in short_list %}
          <a data-enrollment="{{ object.enrollment_total }}" data-year="{{ object.year }}" href="{{ object.get_absolute_url }}">{{ object.name }}</a>
          {% if not forloop.last %}
            <span class="divider">&bull;</span>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}{% endwith %}
  </section>

  <section id="view-map" class="row-fluid map-container">
    <div>
      <h2>
        View All Institutions Statewide
        <small class="btn-group" style="display: inline-block; vertical-align: middle;">
          <a href="#" class="btn btn-mini reset active" data-action="reset">All</a>
          <a href="#" class="btn btn-mini public" data-action="public">Public</a>
          <a href="#" class="btn btn-mini private" data-action="private">Private</a>
        </small>
      </h2>

      <button id="statewideZoom" class="btn" style="position:absolute; display:block; margin: 0 auto -40px;">
        Return to statewide view
      </button>

      <div id="mapCanvas"></div>
    </div>
  </section>

  <div id="mapPopupContainer" class="shadow"><h4>Hover over a campus</h4></div>

  {# TODO associate with maps.js #}
  <script id="mapPopup" type="text/x-handlebars-template">
    <h2>{% templatetag openvariable %}name{% templatetag closevariable %}</h2>
    <h4>{% templatetag openvariable %}city{% templatetag closevariable %}, TX</h4>
  </script>
{% endblock %}


{% block extra_style %}{{ block.super }}
  <link rel="stylesheet" href="{% static 'tx_highered/vendor/leaflet/leaflet.css' %}">
  <!--[if lte IE 8]><link rel="stylesheet" href="{% static 'tx_highered/vendor/leaflet/leaflet.ie.css' %}" /><![endif]-->
{% endblock %}


{% block extra_script %}{{ block.super }}
  <script src="{% static 'tx_highered/vendor/leaflet/leaflet-src.js' %}"></script>
  <script src="{% static 'tx_highered/vendor/handlebars.js/handlebars-1.0.0.beta.6.js' %}"></script>
  <script src="{% static 'tx_highered/js/maps.js' %}"></script>
  <script>
    $(function() {
      // Go to the server for institution API data
      $.get("{% url 'tx_highered:institution_api' %}?fields=city,geojson,is_private",
        function(data) {
          autocomplete_institutions(data);
          map_institutions(data);
        }
      );
    });
  </script>
{% endblock %}
