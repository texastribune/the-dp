{% extends "tx_highered/app_base.html" %}
{% load layout_helpers humanize instachart %}
{% load webdesign %}


{% block head_title %}The Funnel{% endblock %}
{% block page_title %}The Funnel{% endblock %}


{% block main %}
  {% lorem 4 p %}

  {% for object in object_list %}{% if object.funnels %}
    <h3><a href="{{ object.get_absolute_url }}">{{ object.name }}</a></h3>
    {% with funnels=object.funnels %}
      <div class="onion">
        <div class="onion-toggle btn">Fold</div>
        <div class="onion-basket">
          {% for funnel in funnels %}
            <div class="onion-item">
              <table class="funnel">
                <tr><td><div class="bar" style="width: {{ funnel.0 }}%"> {{ funnel.0 }} </td></tr>
                <tr><td><div class="bar" style="width: {{ funnel.1 }}%"> {{ funnel.1 }} </td></tr>
                <tr><td><div class="bar" style="width: {{ funnel.2 }}%"> {{ funnel.2|floatformat }} </td></tr>
              </table>
            </div>
          {% endfor %}
        </div>
        <div class="nav nav-pills onion-legend">
          {% for funnel in funnels %}
            <li class="onion-legend-item">
              <a href="#">{{ funnel.year }}</a>
            </li>
          {% endfor %}
        </div>
      </div>
    {% endwith %}
  {% endif %}{% endfor %}
{% endblock %}


{% block rail %}
  {% render_model object "table" %}
{% endblock %}

{% block extra_style %}{{ block.super }}
<style>
  .onion { }
  .onion-item, .onion-legend-item { display: inline-block; text-align: center; width: 100px; }
  .nav-pills .onion-legend-item { float: none; }
  .funnel { width: 100%; }
  .funnel .bar { background: #0074CC; margin: 0 auto; overflow: hidden; text-indent: 110%; }
  .ui-onion-item-active .bar { outline: 1px solid black; background: transparent; }
</style>
{% endblock %}


{% block extra_script %}{{ block.super }}
<script>
  $(".onion").onionize({
    animate: false,
    afterFold: function(e, ui){
      console.log(e, ui);
      ui.elem.siblings(".onion").not(".ui-onion-active").onionize("fold");
    },
    afterUnfold: function(e, ui){
      console.log(e, ui);
      ui.elem.siblings(".onion.ui-onion-active").onionize("unfold");
    }
  });
</script>
{% endblock %}
